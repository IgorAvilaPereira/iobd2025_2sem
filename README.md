# iobd2025_2sem <br>
## [./00_guia_rapido](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./00_guia_rapido) <br>
[dicas.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/dicas.md) <br>
[introducao-er.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/introducao-er.pdf) <br>
[psql.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/psql.pdf) <br>
[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/pbd2025_2sem/tree/main/00_guia_rapido)
&nbsp;[setup.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/setup.md) <br>
[sql1.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/sql1.pdf) <br>
[sql2.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/sql2.pdf) <br>
[transformacao-er-modelo-relacional.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/transformacao-er-modelo-relacional.pdf) <br>
[videos.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./00_guia_rapido/videos.md) <br>
## [./01_revisao_normalizacao_modelagem_logica](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./01_revisao_normalizacao_modelagem_logica) <br>
[conversao-entre-modelos-er-e-relacional.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/conversao-entre-modelos-er-e-relacional.md) <br>
[dicionario-de-dados.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/dicionario-de-dados.md) <br>
[etapas.png](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/etapas.png) <br>
[iobd2025_2sem.txt](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/iobd2025_2sem.txt) <br>
[lista1.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/lista1.md) <br>
[mapamental.png](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/mapamental.png) <br>
[modelo-relacional.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/modelo-relacional.md) <br>
[normalizacao.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/normalizacao.md) <br>
[normalizacao_resumo.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/normalizacao_resumo.md) <br>
[principais-tiposdedados-postgresql.png](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/principais-tiposdedados-postgresql.png) <br>
[psql.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/psql.pdf) <br>

<!--
* [transformacao-er-relacional-autorelacionamento](https://github.com/IgorAvilaPereira/pmbd2025_1sem/blob/main/4_modelagem_logica/exemplos/exemplo-transformacao-er-relacional-autorelacionamento.dia)
* [transformacao-er-relacional-composto](https://github.com/IgorAvilaPereira/pmbd2025_1sem/blob/main/4_modelagem_logica/exemplos/exemplo-transformacao-er-relacional-composto.dia)
* [transformacao-er-relacional-multivalorado](https://github.com/IgorAvilaPereira/pmbd2025_1sem/blob/main/4_modelagem_logica/exemplos/exemplo-transformacao-er-relacional-multivalorado.dia)
* [transformacao-er-relacional-heranca](https://github.com/IgorAvilaPereira/pmbd2025_1sem/blob/main/4_modelagem_logica/exemplos/exemplo-transformacao-er-relacional-heranca.dia)
* [transformacao-er-relacional-entidade-fraca](https://github.com/IgorAvilaPereira/pmbd2025_1sem/blob/main/4_modelagem_logica/exemplos/exemplo-transformacao-er-relacional-entidade-fraca.dia)
-->

### Vídeo Complementar de Revisão

[Aula 08/05/25](https://www.youtube.com/watch?v=9lpbT6WpkkM)

<!--
### Regras de Normalização

1. **1ª Forma Normal (1FN):** Eliminar grupos repetitivos e garantir que cada campo contenha um único valor
2. **2ª Forma Normal (2FN):** Estar na 1FN e todos os atributos não-chave devem depender totalmente da chave primária
3. **3ª Forma Normal (3FN):** Estar na 2FN e não ter dependências transitivas
-->

### Regras de Mapeamento - ER > Modelo Relacional

[Baixar todo o material da aula](https://download-directory.github.io/?url=https://github.com/IgorAvilaPereira/iobd2025_2sem?tab=readme-ov-file#01_revisao_normalizacao_modelagem_logica-) <br><br>
[sistema_eventos.dia](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/sistema_eventos.dia) <br>
[sistema_eventos.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/sistema_eventos.sql) <br>
[transformacao-er-modelo-relacional.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/transformacao-er-modelo-relacional.pdf) <br>
[imagens](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/imagens) <br>
[regras_mapeamento](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/regras_mapeamento) <br>
[slides_normalizacao](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./01_revisao_normalizacao_modelagem_logica/slides_normalizacao) <br>
## [./02_lista1](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./02_lista1) <br>
[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)

:movie_camera: [SQL: Join's, WITH, Subselect, Group By, STRING_AGG, Having, JDBC, AVG, COUNT, ORDER BY e VIEWS](https://www.youtube.com/watch?v=0y_q_dKNT-0)

<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/02_lista1) <br><br>
&nbsp;
[sistema_eventos.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./02_lista1/sistema_eventos.sql) <br>
[GUIBuilder](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./02_lista1/GUIBuilder) <br>
[sistema_eventos](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./02_lista1/sistema_eventos) <br>
## [./03_lista1](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./03_lista1) <br>
[dao_jdbc.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./03_lista1/dao_jdbc.pdf) <br>
[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)

[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

**Tópicos que devem ser abordados na aula:**

* COALESCE, DISTINCT, CASE WHEN, TYPE, SCHEMAS, CAST, LIMIT, OFFSET e etc.

* Blob's, UUID (futuro)

**JDBC + Java WEB:**

* [JavalinMustacheWithStaticFolder](https://github.com/IgorAvilaPereira/JavalinMustacheWithStaticFolder)

<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/03_lista1) <br><br>
&nbsp;
[sistema_eventos.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./03_lista1/sistema_eventos.sql) <br>
[sistema_eventos](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./03_lista1/sistema_eventos) <br>
## [./04_lista_bloco_26_30](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./04_lista_bloco_26_30) <br>
[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)


<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/04_lista_bloco_26_30) <br><br>
&nbsp;
[sistema_eventos.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./04_lista_bloco_26_30/sistema_eventos.sql) <br>
## [./05_lista_bloco_31_35](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./05_lista_bloco_31_35) <br>
[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)


<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/06_lista_bloco_31_35) <br><br>
&nbsp;
[sistema_eventos.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./05_lista_bloco_31_35/sistema_eventos.sql) <br>
[trabalho1.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./05_lista_bloco_31_35/trabalho1.md) <br>
[aula090925](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./05_lista_bloco_31_35/aula090925) <br>
## [./06_lista_bloco_36_40](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./06_lista_bloco_36_40) <br>
[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)

* inicialmente, a proposta era apenas solucionar o bloco de exercícios, mas ao final terminamos toda a lista

* Implementamos uma funcionalidade em js e javalin

[Vídeo sobre js e javalin](https://youtu.be/yRVu3VSiZeY)

<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/06_lista_bloco_36_40) <br><br>
&nbsp;
[sistema_eventos](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./06_lista_bloco_36_40/sistema_eventos) <br>
## [./07_atendimento_trabalho1](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./07_atendimento_trabalho1) <br>
[alter_table.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./07_atendimento_trabalho1/alter_table.sql) <br>
[Javalin, SQL, Mustache, JDBC, Trabalho 1 (iobd2025_2sem)](https://youtu.be/3drLtu-fVnY)

[Lista 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/01_revisao_normalizacao_modelagem_logica/lista1.md)

[Trabalho 1](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/05_lista_bloco_31_35/trabalho1.md)

<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/07_atendimento_trabalho1) <br><br>
&nbsp;
[sistema_eventos](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./07_atendimento_trabalho1/sistema_eventos) <br>
## [./08_revisao_atividade1](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./08_revisao_atividade1) <br>
[lista1_continuacao.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./08_revisao_atividade1/lista1_continuacao.sql) <br>
* Fazer exercícios adicionais (Lista 1)

* Join's: inner, right/left, cross, full e etc.

* Select

* schemas

* views

* union

* intersect

* except

* coalesce

* extract

* in

* with

* uuid

* alter table

* alter column

* group by

* having

* order by

* offset/limit

* between

<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/08_revisao_atividade1) <br><br>
&nbsp;
## [./09_atividade1](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./09_atividade1) <br>
<br><br>[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/09_atividade1) <br><br>
&nbsp;
## [./10_bytea_oid](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./10_bytea_oid) <br>
[alter_table.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/alter_table.sql) <br>
[bugs.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/bugs.md) <br>
[dao_jdbc.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/dao_jdbc.pdf) <br>
[estrategias_orm.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/estrategias_orm.pdf) <br>
[jdbc.pdf](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/jdbc.pdf) <br>

### Blob's - Bytea e OID (Arquivos)

#### bytea

```sql
CREATE TABLE publicidade.banner (
    id SERIAL PRIMARY KEY,
    arquivo bytea, 
    legenda text, 
    altura integer,
    largura integer,
    link text, -- http://www.g1.com
    tipo text CHECK (tipo = 'SUPERIOR' OR tipo = 'INFERIOR') DEFAULT 'SUPERIOR',
    qtde_cliques INTEGER DEFAULT 0
);

1) INSERT INTO publicidade.banner (arquivo, legenda, link, tipo) VALUES
(pg_read_binary_file('/tmp/globo.png'), 'Clique Aqui', 'http://www.g1.com','SUPERIOR');

2) INSERT INTO publicidade.banner (arquivo, legenda, link, tipo) VALUES
(pg_read_file('/tmp/globo.png')::bytea, 'Clique Aqui', 'http://www.g1.com','SUPERIOR');

```

No JAVA:

```java

-- classe de modelo
public class Banner {
    private int id;  
    private String legenda;
    private int largura;
    private int altura;
    private String link;
    private String tipo;
    private int qtdeCliques;
    private byte[] arquivo;

    // getters and setters...

    public void setArquivo(String diretorio) throws FileNotFoundException, IOException {        
        File f = new File(diretorio);
        FileInputStream fileInputStream = new FileInputStream(f);
        this.arquivo = fileInputStream.readAllBytes();
    }
}

-- classe de persistência
public class BannerDAO {
  private ConexaoPostgreSQL conexaoPostgreSQL;

  public Banner obter(int id) throws SQLException{
        Banner b = new Banner();
        this.conexaoPostgreSQL = new ConexaoPostgreSQL();
        Connection conn = this.conexaoPostgreSQL.getConexao();
        String sql = "SELECT * FROM publicidade.banner WHERE id = ?";
        PreparedStatement preparedStatement = conn.prepareStatement(sql);
        preparedStatement.setInt(1, id);
        ResultSet rs = preparedStatement.executeQuery();
        if (rs.next()){
            b.setId(rs.getInt("id"));
            b.setAltura(rs.getInt("altura"));
            b.setLargura(rs.getInt("largura"));
            b.setLegenda(rs.getString("legenda"));
            b.setLink(rs.getString("link"));
            b.setQtdeCliques(rs.getInt("qtde_cliques"));
            b.setTipo(rs.getString("tipo"));
            b.setArquivo(rs.getBytes("arquivo"));
        }
        conn.close();
        return b;
    }

    public void adicionar(Banner banner, String dir) throws SQLException, FileNotFoundException {
        this.conexaoPostgreSQL = new ConexaoPostgreSQL();
        Connection conn = this.conexaoPostgreSQL.getConexao();
        String sql = "INSERT INTO publicidade.banner "
                + " (arquivo, legenda, link, tipo) VALUES " +
                        "(?,?,?,?);";
        PreparedStatement preparedStatement = conn.prepareStatement(sql);
       
        // opcao 1
        banner.setArquivo(dir);  // chamando o método setArquivo(String dir);
        preparedStatement.setBytes(1, banner.getArquivo());    
        
        // opcao 2
        // File file = new File(dir);
        // FileInputStream fis = new FileInputStream(file);
        // preparedStatement.setBinaryStream(1, fis, file.length());

        preparedStatement.setString(2, banner.getLegenda());
        preparedStatement.setString(3, banner.getLink());
        preparedStatement.setString(4, banner.getTipo());
        preparedStatement.executeUpdate();
        conn.close();
    }

  public ArrayList<Banner> listar() throws SQLException {        
        ArrayList<Banner> vetBanner = new ArrayList<Banner>();
        this.conexaoPostgreSQL = new ConexaoPostgreSQL();
        Connection conn = this.conexaoPostgreSQL.getConexao();
        String sql = "SELECT * FROM publicidade.banner";
        PreparedStatement preparedStatement = conn.prepareStatement(sql);
        ResultSet rs = preparedStatement.executeQuery();
        while (rs.next()){
            Banner b = new Banner();
            b.setId(rs.getInt("id"));
            b.setAltura(rs.getInt("altura"));
            b.setLargura(rs.getInt("largura"));
            b.setLegenda(rs.getString("legenda"));
            b.setLink(rs.getString("link"));
            b.setQtdeCliques(rs.getInt("qtde_cliques"));
            b.setTipo(rs.getString("tipo"));
            b.setArquivo(rs.getBytes("arquivo"));
            vetBanner.add(b);
        }
        conn.close();
        return vetBanner;
    }
   // ...
}

// Main
public class Main {

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) throws SQLException, FileNotFoundException {

       // escrita
       Banner bannerVetorial = new Banner();
       bannerVetorial.setLink("http://vetorial.net");
       bannerVetorial.setLegenda("clique aqui e contrate sua banda larga");
       bannerVetorial.setTipo("SUPERIOR");
       new BannerDAO().adicionar(bannerVetorial, "/home/iapereira/vetorial.png");

        // leitura 
        BannerDAO bannerDAO = new BannerDAO();
        Banner bannerGlobo = bannerDAO.obter(id);
        ImageIcon imageIcon = new ImageIcon(bannerGlobo.getArquivo());
        JFrame jFrame = new JFrame();
        jFrame.setLayout(new FlowLayout());
        jFrame.setSize(500, 500);
        JLabel jLabel = new JLabel();
        jLabel.setIcon(imageIcon);
        jFrame.add(jLabel);
        jFrame.setVisible(true);
        jFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

    }   

```

#### oid (Arquivos Grandes)

```sql
CREATE TABLE largeObjects_Devmedia
 (
   cod_imagem INTEGER,
   nome_imagem VARCHAR(30),
   local_imagem oid,
   CONSTRAINT pk_cod_imagem PRIMARY KEY(cod_imagem)
 );

INSERT INTO public.largeobjects_devmedia(cod_imagem, nome_imagem, local_imagem)
 VALUES (1, 'naruto_shippuden', lo_import('D:/imagens/naruto_shippuden.jpg'));
```

Perceba que no momento de inserção dos dados na tabela utilizamos a função específica _lo_import()_, que é utilizada para carregar imagens para a tabela de sistema pg_largeobjects.

Obs: Caso os dados não sejam inseridos na tabela, é necessário atribuir as devidas permissões no banco de dados, usando a seguinte instrução:

```sql
GRANT SELECT, INSERT, UPDATE ON pg_largeobject TO PUBLIC;
```

De forma similar a importação da imagem para a base de dados, podemos também exportá-la para a nossa máquina utilizando a função lo_export() com as informações de OID e o local no qual será armazenada a imagem como parâmetros , de acordo com a seguinte instrução:

```sql
SELECT lo_export(32784, 'D:/imagens/naruto_shippuden.jpg');
```

Temos também a função lo_unlink(), que é utilizada para realizar a remoção do objeto, como podemos observar na instrução a seguir:

```sql
SELECT lo_unlink(32784);
```

**Links Complementares:**

* :fire: https://www.postgresql.org/docs/7.4/jdbc-binary-data.html

* https://www.cybertec-postgresql.com/en/binary-data-performance-in-postgresql/

* http://postgresqlbr.blogspot.com/2013/04/trate-com-blobs-e-clobs-diretamente-no.html

* https://www.devmedia.com.br/trabalhando-com-large-objects-no-postgresql/34167

<!-- https://github.com/IgorAvilaPereira/iobd2022_2sem/blob/main/PortalDeNoticiasBanners -->

[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./10_bytea_oid)
[resumao_bytea_oid.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/resumao_bytea_oid.md) <br>
[sistema_eventos](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./10_bytea_oid/sistema_eventos) <br>
## [./11_correcao_bugs](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./11_correcao_bugs) <br>
[bugs.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./11_correcao_bugs/bugs.md) <br>
[trabalho2.md](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./11_correcao_bugs/trabalho2.md) <br>
## [./12_heranca_postgresql](https://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./12_heranca_postgresql) <br>
[exemplo.sql](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./12_heranca_postgresql/exemplo.sql) <br>
[exemplo-transformacao-er-relacional-heranca.dia](https://github.com/IgorAvilaPereira/iobd2025_2sem/blob/main/./12_heranca_postgresql/exemplo-transformacao-er-relacional-heranca.dia) <br>
### Herança de Tabelas PostgreSQL

#### ✅ O que é herdado pelas tabelas filhas (`INHERITS`) no PostgreSQL?

| Tipo de Restrição / Comportamento | É herdado? |
| --------------------------------- | ---------- |
| Colunas                           | ✅ Sim      |
| Tipos de dados                    | ✅ Sim      |
| **PRIMARY KEY**                   | ❌ Não      |
| **UNIQUE**                        | ❌ Não      |
| **CHECK**                         | ❌ Não      |
| **FOREIGN KEY (FK)**              | ❌ Não      |
| **Índices**                       | ❌ Não      |
| **Triggers**                      | ❌ Não      |

---

#### ❗ Ou seja:

* Se você cria uma constraint `UNIQUE(email)` na tabela pai (`pessoa`), **isso não se aplica automaticamente às tabelas filhas**.
* Se você define uma `FOREIGN KEY` na tabela pai, **ela não é aplicada às filhas**.
* Cada tabela filha precisa **definir explicitamente** essas constraints, se quiser garantir o comportamento.

---

#### 📌 Exemplo Prático

##### Tabela Pai:

```sql
CREATE TABLE pessoa (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    nome TEXT NOT NULL,
    email TEXT NOT NULL,
    CONSTRAINT email_unico UNIQUE (email),
    CHECK (char_length(nome) > 2)
);
```

#### Tabela Filha:

```sql
CREATE TABLE cliente (
    data_cadastro DATE NOT NULL DEFAULT CURRENT_DATE
) INHERITS (pessoa);
```

#### O que acontece aqui?

* A coluna `email` é herdada ✔️
* A constraint `UNIQUE(email)` **não é aplicada** ❌
* A `CHECK (char_length(nome) > 2)` **não é aplicada** ❌
* O `PRIMARY KEY` **não é aplicado** ❌

---

#### 🧠 O que você deve fazer?

Você precisa **reaplicar manualmente as constraints** nas tabelas filhas:

```sql
-- Reaplicando constraints manualmente
ALTER TABLE cliente ADD CONSTRAINT cliente_pkey PRIMARY KEY (id);
ALTER TABLE cliente ADD CONSTRAINT cliente_email_unico UNIQUE (email);
ALTER TABLE cliente ADD CHECK (char_length(nome) > 2);
```

---

#### ✅ Melhor Alternativa para Produção

Evite `INHERITS` se precisar de integridade forte (como `FK`, `UNIQUE`, etc). Em vez disso:

* Crie uma **tabela base** (`pessoa`)
* E especializações com **chave estrangeira** para `pessoa(id)`

#### Exemplo:

```sql
CREATE TABLE pessoa (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    nome TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL
);

CREATE TABLE cliente (
    pessoa_id UUID PRIMARY KEY REFERENCES pessoa(id),
    data_cadastro DATE NOT NULL
);
```

Essa abordagem suporta 100% de:

* Chaves primárias e estrangeiras ✅
* Checks e constraints ✅
* Índices ✅
* Integridade forte e controle total ✅

&nbsp;[Baixar todo o material da aula](https://download-directory.github.io/?url=http://github.com/IgorAvilaPereira/iobd2025_2sem/tree/main/./12_heranca_postgresql)
